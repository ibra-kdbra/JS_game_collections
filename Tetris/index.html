<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern Tetris</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="./imgs/tetris.ico">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/responsive.css">
  
  <!-- Background -->
  <style>
    body {
      background-image: url('./imgs/water_leave_drops.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }
    
    /* Fallback background for mobile */
    @media (max-width: 768px) {
      body {
        background-attachment: scroll;
      }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <!-- Main Game Area -->
    <main id="game-board" class="panel">
      <canvas id="bgStack"></canvas>
      <canvas id="stack"></canvas>
      <canvas id="active"></canvas>
      <p id="game-message"></p>

      <!-- Main Menu -->
      <nav class="menu active" id="main-menu">
        <h1>Tetris</h1>
        <div class="version">Modern Responsive Edition</div>
        <ul class="menu-list">
          <li><button onclick="GameManager.init('sprint')" class="menu-btn"><i class="fas fa-play"></i> Sprint</button></li>
          <li><button onclick="GameManager.init('dig')" class="menu-btn"><i class="fas fa-mountain"></i> Dig Race</button></li>
          <li><button onclick="GameManager.showMenu('settings')" class="menu-btn"><i class="fas fa-cog"></i> Settings</button></li>
          <li><button onclick="GameManager.showMenu('controls')" class="menu-btn"><i class="fas fa-keyboard"></i> Controls</button></li>
        </ul>
      </nav>

      <!-- Settings Menu -->
      <nav class="menu" id="settings-menu">
        <h2><i class="fas fa-cog"></i> Settings</h2>
        <div id="settings-container">
          <!-- Settings will be generated by JavaScript -->
        </div>
        <button class="back-btn" onclick="GameManager.showMenu('main')"><i class="fas fa-arrow-left"></i> Back</button>
      </nav>

      <!-- Controls Menu -->
      <nav class="menu" id="controls-menu">
        <h2><i class="fas fa-keyboard"></i> Controls</h2>
        <div class="controls-info">Click on any control to rebind it</div>
        <table id="controls-table">
          <tr><th>Move Left:</th><td id="moveLeft" data-action="moveLeft">←</td></tr>
          <tr><th>Move Right:</th><td id="moveRight" data-action="moveRight">→</td></tr>
          <tr><th>Soft Drop:</th><td id="moveDown" data-action="moveDown">↓</td></tr>
          <tr><th>Hard Drop:</th><td id="hardDrop" data-action="hardDrop">Space</td></tr>
          <tr><th>Rotate CW:</th><td id="rotRight" data-action="rotRight">X</td></tr>
          <tr><th>Rotate CCW:</th><td id="rotLeft" data-action="rotLeft">Z</td></tr>
          <tr><th>Rotate 180:</th><td id="rot180" data-action="rot180">Shift</td></tr>
          <tr><th>Hold:</th><td id="holdPiece" data-action="holdPiece">C</td></tr>
          <tr><th>Pause:</th><td id="pause" data-action="pause">Esc</td></tr>
          <tr><th>Retry:</th><td id="retry" data-action="retry">R</td></tr>
        </table>
        <button class="back-btn" onclick="GameManager.showMenu('main')"><i class="fas fa-arrow-left"></i> Back</button>
      </nav>

      <!-- Game Over Menu -->
      <nav class="menu" id="gameover-menu">
        <h2><i class="fas fa-trophy"></i> Game Over</h2>
        <div class="stats">
          <div id="final-lines">Lines: 0</div>
          <div id="final-time">Time: 00:00</div>
          <div id="final-pieces">Pieces: 0</div>
        </div>
        <ul class="menu-list">
          <li><button onclick="GameManager.retry()" class="menu-btn"><i class="fas fa-redo"></i> Retry</button></li>
          <li><button onclick="GameManager.showMenu('main')" class="menu-btn"><i class="fas fa-home"></i> Main Menu</button></li>
        </ul>
      </nav>

      <!-- Pause Menu -->
      <nav class="menu" id="pause-menu">
        <h2><i class="fas fa-pause"></i> Paused</h2>
        <ul class="menu-list">
          <li><button onclick="GameManager.resume()" class="menu-btn"><i class="fas fa-play"></i> Resume</button></li>
          <li><button onclick="GameManager.retry()" class="menu-btn"><i class="fas fa-redo"></i> Retry</button></li>
          <li><button onclick="GameManager.showMenu('main')" class="menu-btn"><i class="fas fa-home"></i> Main Menu</button></li>
        </ul>
      </nav>
    </main>

    <!-- Game Stats Panel -->
    <aside id="stats-panel" class="panel">
      <div class="stats-section">
        <h3><i class="fas fa-pause-circle"></i> Hold</h3>
        <canvas id="hold"></canvas>
      </div>
      
      <div class="stats-table">
        <div class="stat-item">
          <span class="stat-value" id="lines-remaining">40</span>
          <span class="stat-label">Lines</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="pieces-placed">0</span>
          <span class="stat-label">Pieces</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="timer">00:00</span>
          <span class="stat-label">Time</span>
        </div>
      </div>
      
      <div class="replay-controls" id="replay-controls" style="display: none;">
        <button onclick="GameManager.replay(-1)" class="control-btn"><i class="fas fa-step-backward"></i></button>
        <button onclick="GameManager.replay()" class="control-btn"><i class="fas fa-play"></i>/<i class="fas fa-pause"></i></button>
        <button onclick="GameManager.replay(1)" class="control-btn"><i class="fas fa-step-forward"></i></button>
      </div>
    </aside>

    <!-- Next Piece Panel -->
    <aside id="next-panel" class="panel">
      <h3><i class="fas fa-eye"></i> Next</h3>
      <canvas id="preview"></canvas>
    </aside>
  </div>

  <!-- Hidden sprite canvas for rendering -->
  <canvas id="sprite" style="display: none;"></canvas>

  <!-- Mobile Touch Controls -->
  <div id="mobile-controls" class="mobile-controls">
    <div class="mobile-controls-left">
      <button class="mobile-btn" data-action="rotCCW"><i class="fas fa-undo"></i></button>
      <button class="mobile-btn" data-action="hardDrop"><i class="fas fa-arrow-down"></i></button>
      <button class="mobile-btn" data-action="rotCW"><i class="fas fa-redo"></i></button>
    </div>
    <div class="mobile-controls-center">
      <button class="mobile-btn large" data-action="softDrop"><i class="fas fa-arrow-down"></i></button>
    </div>
    <div class="mobile-controls-right">
      <button class="mobile-btn" data-action="moveLeft"><i class="fas fa-arrow-left"></i></button>
      <button class="mobile-btn hold" data-action="hold"><i class="fas fa-hand-paper"></i></button>
      <button class="mobile-btn" data-action="moveRight"><i class="fas fa-arrow-right"></i></button>
    </div>
  </div>

  <!-- JavaScript Modules -->
  <script type="module" src="js/modules/GameManager.js"></script>
  <script type="module" src="js/modules/Piece.js"></script>
  <script type="module" src="js/modules/Board.js"></script>
  <script type="module" src="js/modules/Preview.js"></script>
  <script type="module" src="js/modules/Hold.js"></script>
  <script type="module" src="js/modules/Settings.js"></script>
  <script type="module" src="js/modules/Input.js"></script>
  <script type="module" src="js/modules/Responsive.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
